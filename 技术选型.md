#### 1.引言

本文档根据项目细化的四大功能模块 (M1-M4) 及其具体功能点，提出一套完整、高效的技术选型方案。选型的核心目标是：**技术栈统一**、**开发迅速**、**无缝部署**，并确保所有需求点都有明确的技术方案与之对应。

------



#### **2. 整体架构选型**



| **角色**         | **技术选型**                 | **选型理由**                                                 |
| ---------------- | ---------------------------- | ------------------------------------------------------------ |
| **全栈框架**     | **Next.js (TypeScript)**     | **开发效率核心**。单一框架即可满足前后端所有需求，是最高效的选择。前端页面 (React) 和后端逻辑 (API Routes) 使用同一种语言，极大简化了开发和维护。 |
| **数据库与认证** | **Supabase**                 | **完美匹配 M3 模块需求**。提供一站式用户认证、数据库和云同步解决方案，其 `supabase-js` 客户端库能轻松实现用户注册/登录、行程与费用的增删改查及云同步 (3.1.1 - 3.2.3)。 |
| **UI/UX 方案**   | **Tailwind CSS + shadcn/ui** | **快速构建响应式界面 (4.1.1)**。Tailwind CSS 保证了响应式布局的快速开发。shadcn/ui 提供高质量的组件基础（输入框、按钮、图表、弹窗），可直接用于构建 M1 的输入界面、M2 的记账表单和 M4 的设置页面。 |
| **部署平台**     | **Vercel**                   | **简化运维，专注开发**。与 Next.js 无缝集成，提供 Git 推送即部署的自动化流程，开发者无需关心服务器配置，可以专注于功能实现。 |

------



#### **3. 模块功能与技术方案映射**





##### **M1: 智能行程规划 (Intelligent Trip Planning)**



| **功能点**                     | **需求描述**             | **技术方案**                                                 |
| ------------------------------ | ------------------------ | ------------------------------------------------------------ |
| **1.1.1 文本输入**             | 主输入框，引导用户输入   | **React (useState) + shadcn/ui (Input, Textarea)**: 管理和渲染输入框组件。 |
| **1.1.2 语音输入**             | 麦克风按钮，语音转文字   | **Web Speech API**: 在浏览器端直接实现语音识别，无需后端服务。通过 JavaScript 监听识别结果并更新 React 状态。 |
| **1.1.3 快捷标签**             | 点击标签添加偏好         | **React (useState) + shadcn/ui (Button/Badge)**: 管理标签状态，点击后拼接字符串到主输入框。 |
| **1.2.1-1.2.3 生成/加载/错误** | 异步请求与状态反馈       | **SWR / React Query**: 用于处理对 Next.js API Route 的数据请求，内置了管理加载 (loading) 和错误 (error) 状态的机制。 |
| **1.2.4 地图视图**             | 地图展示、图钉、路线     | **React-map-gl**: 强大的 React 地图库，用于渲染地图、自定义图钉 (Markers) 和绘制路线 (Polylines)。 |
| **1.2.5 时间线视图**           | 按天展示行程列表，含图片 | **React 组件**: 自定义开发或使用 `react-timeline` 等库。通过 `map` 函数遍历 AI 返回的数据数组进行渲染。使用 Next.js 的 `<Image>` 组件优化图片加载。 |
| **1.3.1 查看详情**             | 展开/弹窗显示详细信息    | **shadcn/ui (Dialog/Popover)**: 用于创建交互友好的弹窗，展示景点的详细信息。 |
| **1.3.2 保存行程**             | 将行程存入用户账户       | **Next.js API Route + Supabase Client**: 前端触发 API 请求，后端 API 路由接收数据，并使用 Supabase 客户端将行程数据写入与用户 ID 关联的数据库表中。 |
| **1.3.3 重新生成**             | 使用相同需求再次请求     | **SWR / React Query**: 调用其 `mutate` 或 `refetch` 方法即可轻松实现数据的重新请求。 |



##### **M2: 费用预算与管理 (Expense Management)**



| **功能点**                     | **需求描述**       | **技术方案**                                                 |
| ------------------------------ | ------------------ | ------------------------------------------------------------ |
| **2.1.1-2.1.2 AI 预算分析**    | 预算估算与分解图表 | **阿里云百炼 API + Recharts/Chart.js**: AI 在生成行程时一并返回预算 JSON。前端使用 **Recharts** 库将预算分解数据渲染为饼图。 |
| **2.2.1 手动记账**             | 记账表单与数据提交 | **React Hook Form + shadcn/ui (Form, Input, Select)**: 用于构建和验证记账表单。提交后调用 Next.js API Route 存入 Supabase。 |
| **2.2.2 语音记账**             | 语音识别并填充表单 | **Web Speech API + 自然语言处理**: 使用 Web Speech API 捕获语音。后端 API Route 中可以加入简单的规则或调用 LLM，从 "今天吃饭花了 100 块" 中提取出金额 (100) 和类别 (餐饮)。 |
| **2.2.3-2.2.4 账单列表与统计** | 记录展示与消费分析 | **Supabase Client + Recharts**: 从 Supabase 实时查询消费记录并展示。使用 Recharts 对数据进行分组和可视化，实现消费统计图表。 |



##### **M3: 用户中心与数据同步 (User & Data)**



| **功能点**                     | **需求描述**           | **技术方案**                                                 |
| ------------------------------ | ---------------------- | ------------------------------------------------------------ |
| **3.1.1-3.1.3 账户系统**       | 注册、登录、密码重置   | **Supabase Authentication**: 提供完整的用户认证解决方案，包括 UI 组件 (`supabase/auth-ui-react`) 和后端方法，可快速实现所有账户功能。 |
| **3.2.1-3.2.3 数据管理与同步** | 行程列表、管理、云同步 | **Supabase Client**: 提供了简单易用的 API (`select`, `insert`, `update`, `delete`) 来管理数据库中的用户数据。其实时 (Realtime) 功能可以确保数据在多设备间的自动同步。 |



##### **M4: 通用与设置 (General & Settings)**



| **功能点**             | **需求描述**     | **技术方案**                                                 |
| ---------------------- | ---------------- | ------------------------------------------------------------ |
| **4.1.1 响应式布局**   | 适应不同设备     | **Tailwind CSS**: 其移动优先的响应式设计系统 (`sm:`, `md:`, `lg:`) 能轻松实现跨设备兼容的 UI。 |
| **4.1.2 导航栏/菜单**  | 全局导航         | **Next.js Layout Component + shadcn/ui (Navigation Menu)**: 在 Next.js 的 `_app.tsx` 或布局组件中构建全局导航，确保在所有页面共享。 |
| **4.2.1 API Key 配置** | 输入框，保存 Key | **React (useState) + localStorage**: 使用受控组件管理输入框状态，当用户保存时，将 API Key 存入浏览器的 `localStorage` 中。在发起 API 请求时，从 `localStorage` 读取该 Key。 |
| **4.2.2 关于页面**     | 静态信息展示     | **Next.js (Static Page)**: 创建一个简单的静态页面组件来展示项目信息。 |